language: python
branches:
  only:
    master
python:
  - "2.7"
  - "3.5"
before_install:
  # add a latex install for the matplotlib testing
  - sudo apt-get -qq update && sudo apt-get install -y --no-install-recommends texlive-full
install:
  - pip install -r requirements.txt
  # install additionally allowed packages
  - pip install matplotlib ads
  # install packages for documentation building
  - pip install sphinx sphinx-rtd-theme
  # build psrqpy
  - pip install -e .
before_script: # configure a headless display to test plot generation (see https://stackoverflow.com/a/35403128/1862861)
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
script:
  # try running a query
  - python -c "import sys; from psrqpy import QueryATNF; query = QueryATNF(params='JName'); fig = query.ppdot(); sys.exit(0)"
  # try building documentation
  - cd docs
  - mkdir source/_static
  - sphinx-apidoc ../psrqpy -o .
  - make html

